
## å‰è¨€

åšå€‹åŸºæ–¼åœ°åœ–çš„æ•£ä½ˆåœ– Side Project ä¾†å­¸ç¿’æ–°å·¥å…·ï¼Œä¸»è¦ç”¨åˆ° React, TypeScript, Tailwind, mapbox, deck.gl é€™å¹¾å€‹ã€‚

## ç›®æ¨™
- å­¸ç¿’ä½¿ç”¨æ–°å·¥å…·å»ºæ§‹æ‡‰ç”¨
- é‡å°å¤§é‡è³‡æ–™é€²è¡Œæ•ˆèƒ½å„ªåŒ–

### æ¬¡è¦ç›®æ¨™
æ­¤æ¬¡çš„ä¸»è¦ç›®æ¨™æ˜¯å€‹äººå­¸ç¿’æ–°å·¥å…·ï¼Œå› æ­¤å°‡åœ˜éšŠè¦ç¯„èˆ‡å¾ŒçºŒç¶­è­·æ”¾åœ¨æ¬¡è¦ç›®æ¨™ï¼Œä¸»è¦ç›®æ¨™å®Œæˆå†è€ƒæ…®å›ä¾†é€²è¡Œã€‚

- å»ºæ§‹å”ä½œè¦ç¯„å¦‚: Coding Style, Lint, etc
- å»ºæ§‹æ¸¬è©¦å¦‚: Unit Test, Integrated Testing, etc


## è¦åŠƒ
- å…ˆç”¨å°‘é‡è³‡æ–™åšä¸€å€‹å¯ä»¥é‹ä½œçš„ç‰ˆæœ¬ï¼Œç†Ÿæ‚‰ä¸€ä¸‹ React, TypeScript, Tailwind CSS çš„å¯«æ³•
- ç°¡å–®æ¥å…¥å¤§é‡è³‡æ–™åˆ°åœ°åœ–ä¸Šå‘ˆç¾ï¼Œé‡æ¸…æ•ˆèƒ½ç‹€æ³
- åƒè€ƒ Mapbox, deck.gl çš„å»ºè­°é€²è¡Œæ•ˆèƒ½å„ªåŒ–
- ç¢ºèªæ•ˆèƒ½æ˜¯å¦æœ‰æ­£ç¢ºæå‡


## ç¬¬ä¸€é€±å°çµ

[Online Demo](https://scatter-plots-on-maps.vercel.app/)
åŸºæœ¬åªå®Œæˆäº†ç¬¬ä¸€å€‹ç›®æ¨™ï¼šå­¸ç¿’ä½¿ç”¨æ–°å·¥å…·å»ºæ§‹ Scatter Mapï¼Œç¬¬äºŒå€‹ç›®æ¨™éƒ½æ²’æœ‰å‹•åˆ°ã€‚å¹¾å€‹å¿ƒå¾—å¦‚ä¸‹ï¼š
1. TypeScript æ˜¯å¤§é­”ç‹ï¼Œè¦æ‰¾æ™‚é–“å¥½å¥½å­¸ç¿’ã€‚
2. Tailwind ç”¨èµ·ä¾†å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯é‚£å€‹ style éƒ½æ“ åœ¨ class è£¡é¢ï¼Œä¸å¤ªå¥½çœ‹ï¼Œä¹Ÿå¾ˆå®¹æ˜“è·Ÿå…¶ä»–æ±è¥¿æåœ¨ä¸€èµ·ã€‚æœ‰äº›æƒ…æ³ç”¨ css è™•ç†æ„Ÿè¦ºé‚„æ˜¯æ¯”è¼ƒé †æ‰‹ï¼Œå¯«ä½œé¢¨æ ¼é‚„è¦å†æƒ³ä¸€ä¸‹ã€‚å¯ä»¥å°‡ style é€²è¡Œæ¨¡çµ„åŒ–ï¼Œä½†ç›®å‰æ²’å¤ªå¤šç¢ç£¨é€™å¡Šã€‚
3. React çš„ç”Ÿå‘½é€±æœŸèˆ‡åŸç†å¯ä»¥å†çœ‹ç†Ÿæ‚‰ä¸€é»ã€‚


## æ¯æ—¥é€²åº¦ç´€éŒ„

### Day 0

- å¿«é€Ÿç ”ç©¶ä¸€ä¸‹ Mapbox è·Ÿ deck.gl åœ¨å¹¹å˜›ã€‚
    - [Mapbox](https://www.mapbox.com/): åŸºæ–¼ WebGL çš„åœ°åœ–å·¥å…·
    - [deck.gl](https://deck.gl/): åŸºæ–¼ WebGL ç”¨ä¾†åšå¤§é‡è³‡æ–™çš„è¦–è¦ºåŒ–å‘ˆç¾ï¼Œç¶“å¸¸æ­é… WebGL åœ°åœ–å·¥å…·ä¸€èµ·ä½¿ç”¨
- çœ‹äº†ä¸€ä¸‹å®˜ç¶²è·Ÿå…¶ä»–äººæ‰€æåˆ°çš„å„ªåŒ–ç­–ç•¥
    - [deck.gl Performance Optimization](https://deck.gl/docs/developer-guide/performance)
    - [Improve the performance of Mapbox GL JS maps](https://docs.mapbox.com/help/troubleshooting/mapbox-gl-js-performance/)
    - [algorithmic thinking](https://speakerdeck.com/mourner/fast-by-default-everyday-algorithmic-thinking-for-developers): æ¸›å°‘éå¿…è¦çš„è¨˜æ†¶é«”ä½¿ç”¨ã€æ¸›å°‘éå¿…è¦çš„è¿´åœˆæ“ä½œç­‰
    - æœ€å°åŒ–è³‡æ–™è®Šæ›´ã€é¸æ“‡åˆé©çš„åœ°æ–¹é€²è¡Œè³‡æ–™æ“ä½œï¼Œå°¤å…¶é¿å…åœ¨è³‡æ–™æ¸²æŸ“çš„éšæ®µé€²è¡Œã€‚
    - é¿å…éæ–¼è¤‡é›œçš„ Layer æ¸²æŸ“ï¼Œè€ƒæ…®ä½¿ç”¨ç–ŠåŠ  Layer é”æˆåŒæ¨£çš„è¦–è¦ºæ•ˆæœï¼Œä½†æ•¸é‡è¦æ§åˆ¶åœ¨ç™¾ä½æ•¸å…§
    - Uncremental Data Loading
    - [Web Worker](https://www.ruanyifeng.com/blog/2018/07/web-worker.html): å‰ç«¯å¤šç·šç¨‹ï¼Œæœƒåœ¨ Javascript ä¸»ç·šç¨‹ä¹‹å¤–é€²è¡Œã€‚
    - Use [Binary Data](https://blog.techbridge.cc/2017/09/24/binary-data-manipulations-in-javascript/)
- ç„¶å¾Œåˆå¤šäº†å¥½å¤šå€‹æ–°å·¥å…·è¦å­¸ç¿’
- é‚„è¦ç ”ç©¶ä¸€ä¸‹æ•ˆèƒ½æª¢é©—çš„æ–¹å¼è·ŸæŒ‡æ¨™
- è¨˜éŒ„ä¸€ä¸‹é€™å€‹å­¸ç¿’éç¨‹

å¦å¤–é‚„æœ‰ä¸€äº›æ€è·¯æ˜¯å¾æ›´åº•å±¤ç¿»æ‰ï¼Œä¾‹å¦‚ [mapbox-gl-rs](https://lib.rs/crates/mapboxgl) æ˜¯ç”¨ Rust ç¿»å¯« mapbox-gl-jsï¼Œé€éç·¨è­¯æˆ WebAssemblyï¼Œåœ¨ Web ç€è¦½å™¨ä¸Šä»¥æ¥è¿‘åŸç”Ÿæ‡‰ç”¨ç¨‹å¼çš„æ•ˆèƒ½é‹è¡Œï¼Œä½†é€™å€‹å°ˆæ¡ˆé‚„åœ¨å¾ˆæ—©æœŸï¼Œä¹Ÿé›¢é¡Œå¤ªé ã€‚å€’æ˜¯åœ¨ä¸€äº›è¨ˆç®—ä¸Šæœ‰æ˜é¡¯æ•ˆèƒ½ç“¶é ¸çš„åœ°æ–¹ï¼Œæˆ–è¨±å¯ä»¥è€ƒæ…®ç”¨ WebAssembly æ”¹å¯«è©¦è©¦ï¼Ÿ


### Day 1

å»ºç«‹äº†ç’°å¢ƒä»¥åŠçœ‹ä¸€ä¸‹ Tailwind çš„å®˜æ–¹æ–‡ä»¶ï¼Œæ‹‰äº†ä¸€ä¸‹ç°¡å–®çš„ Layoutï¼ŒæŠŠæ˜¨å¤©è·Ÿä»Šå¤©çš„ç­†è¨˜éƒ½è¨˜éŒ„ä¸€ä¸‹ã€‚ç„¶å¾Œå°±æ˜¯åœ¨æ²’æœ‰ UI Framework çš„æƒ…æ³ä¸‹ï¼Œæœ‰äº›çµ„ä»¶å¾—è‡ªå·±æƒ³è¾¦æ³•ï¼Œåˆ—é€²å¾…è¾¦äº‹é …ã€‚

#### ç’°å¢ƒå»ºç½®

æœ€å¾Œé¸æ“‡ç›´æ¥ä¸Š Nuxt.js + Tailwind CSSï¼Œç”¨äº†ä¸€ä¸‹ create-react-app + Tailwindï¼Œé‚„æ˜¯æœ‰ä¸€äº›å°åœ°æ–¹è¦è‡ªå·±è™•ç†ï¼Œåè€Œç›´æ¥ç…§è‘— [Install Tailwind CSS with Next.js](https://tailwindcss.com/docs/guides/nextjs) èµ°å®Œï¼Œå°±æŠŠæˆ‘è¦çš„æ±è¥¿éƒ½å»ºç½®å¥½äº†ï¼Œ~~é †ä¾¿ç›´æ¥è®Šæˆå…¨ç«¯æ¡†æ¶~~ã€‚é™¤äº†ä¸å°å¿ƒå¤šäº† Nextï¼Œå…¶ä»– React, TypeScript, Eslint, Tailwind CSS å°±éƒ½æå®šäº†ï¼Œå¾Œç«¯è³‡æ–™çš„éƒ¨åˆ†ï¼Œåˆ°æ™‚å€™ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ Nuxt åšã€‚

### å»ºæ§‹ç•«é¢

- ä¸»è¦ç•«é¢å‘ˆç¾åœ°åœ–
- æ—é‚Šæœ‰é¢æ¿å¯ä»¥è¨­å®šç¯©é¸æ¢ä»¶

#### Tailwind

ç¨å¾®çœ‹äº†ä¸€ä¸‹å®˜ç¶²ï¼Œä¹Ÿè©¦è‘—ç”¨äº†ä¸‹ï¼Œæ„Ÿå—æ»¿ä¸éŒ¯çš„ã€‚
- ä½œç‚ºä¸€å€‹ utility-first çš„å·¥å…·ï¼Œåšå¾—å¾ˆå¥½ã€‚
- æœ‰ç¾æˆçš„ Components & Templates ä½†æ˜¯åŸºæœ¬ä¸Šéœ€è¦ä»˜è²»å–å¾—ã€‚
- å› ç‚ºç²’åº¦å¾ˆç´°ï¼Œå…¨éƒ¨ç†Ÿæ‚‰ä¸€æ¬¡é —èŠ±æ™‚é–“ï¼Œä½†ä¸ç†Ÿæ‚‰åˆå¯«ä¸å‡ºä¾†ï¼Œæœ‰ä¸€ç¨®åœ¨å…¨éƒ¨é‡æ–°è¤‡ç¿’ä¸€æ¬¡ CSS èªæ³•çš„æ„Ÿè¦ºã€‚
- å¯«ä½œä¸Šçš„æ„Ÿè¦ºä¹Ÿæœ‰é»è®ŠåŒ–ï¼Œä»¥å¾€ç¶“å¸¸æœƒéœ€è¦ç‚ºæ¯ä¸€å±¤ Eelement å‘½å Classï¼Œé€šå¸¸æœƒæ ¹æ“š Element æœ¬èº«çš„ç”¨é€”å‘½åï¼Œå†æŒ‡å®š CSS ä¸Šå»ã€‚ä½†ç¾åœ¨å¥½åƒä¸å¤ªä¸€æ¨£äº†ï¼Œåè€Œæ›´éœ€è¦æ€è€ƒï¼Œé€™äº›åªè·Ÿ Style æœ‰é—œçš„ Classesï¼Œä»–å€‘èšé›†åœ¨ä¸€èµ·çš„æŠ½è±¡æ¦‚å¿µæ˜¯ä»€éº¼ï¼Ÿ
- æ¨è–¦å®‰è£ VS Code Plugin: Tailwind CSS IntelliSenseï¼Œå¯ä»¥å¿«é€Ÿæœå°‹å¯ç”¨çš„èªæ³•

#### å¾…è¾¦äº‹é …å¢åŠ 
- Multi Range Slider
- Tooltip

### Day 2

è‡ªå·±å¯«ä¸€å€‹ Multi Range Slider Componentï¼Œåˆæ­¥ç†Ÿæ‚‰ä¸€ä¸‹ React è·Ÿ TypeScript çš„å¯¦ä½œçµåˆä»¥åŠ ...CSSï¼Œç„¶å¾Œå°±èŠ±äº†ä¸€æ•´å¤©ã€‚

#### å¦‚ä½•è‡ªè£½ Multi Range Sliderï¼Ÿ
åƒè€ƒé€™ç¯‡æ–‡ç«  [Building a Multi-Range Slider in React From Scratch](https://dev.to/sandra_lewis/building-a-multi-range-slider-in-react-from-scratch-4dl1)ï¼Œç ”ç©¶ä»–çš„æ€è·¯è‡ªå·±åšä¸€å€‹ã€‚

æ‹–æ‹‰çš„æŒ‰éˆ•ç›´æ¥å€Ÿç”¨åŸç”Ÿ Range Input ä¾†å¯¦ç¾ï¼Œå°±æ˜¯æŠŠå…©å€‹ Range Input ç–Šåœ¨ä¸€èµ·ï¼Œç”¢ç”Ÿå…©å€‹æ‹–æ‹‰çš„æŒ‰éˆ•ã€‚ä½¿ç”¨ pointer-events: none è®“ä¸Šå±¤çš„äº‹ä»¶è§¸ç™¼ç„¡æ•ˆï¼Œç„¶å¾Œç”¨å½å…ƒç´ é¸æ“‡åˆ°ç€è¦½å™¨å¯¦ç¾çš„æ‹–æ‹‰æŒ‰éˆ•ï¼Œè¨­ç½® pointer-events: all ã€‚åˆ°æ­¤å°±å¯¦ç¾äº†å…©å€‹å¯ä»¥æ‹–æ‹‰çš„æŒ‰éˆ•ã€‚è©³ç´°åƒè€ƒ[é€™ç¯‡](https://www.minwt.com/webdesign-dev/css/20208.html)ä»¥åŠ[é€™ç¯‡](https://www.oxxostudio.tw/articles/201503/html5-input-range-style.html)æ”¹è®Šæ¨£å¼çš„æ–¹æ³•

å‰©ä¸‹çš„é‚è¼¯è·Ÿç•«é¢ï¼Œå¤§è‡´ä¸Šå°±å¯ä»¥è‡ªå·±å¯¦ç¾äº†ã€‚ä»–çš„ç‰ˆæœ¬é‚„ç”¨åˆ°äº† useRef, useEffect, useCallback ç­‰å° DOM é€²è¡Œæ“ä½œæˆ–æ˜¯ç­‰å¾… state æ›´æ–°ä¹‹å¾Œå†é€²è¡Œè³‡æ–™æ“ä½œï¼Œæ„Ÿè¦ºæ¯”è¼ƒè¤‡é›œã€‚è‡ªå·±å¯¦ç¾çš„ç‰ˆæœ¬åªéœ€è¦ç”¨åˆ° useState å°±å¯ä»¥äº†ï¼Œå…ˆæŠŠè¦åšçš„è³‡æ–™æ“ä½œå‡½å¼å®šç¾©å¥½ï¼Œè¼¸å…¥æ¥å— stateï¼Œç›´æ¥ç¶åœ¨ JSX è£¡é¢å³å¯ã€‚

å¦å¤–æŠŠ value å‘ˆç¾çš„ format é–‹æ”¾å‡ºä¾†å¯ä»¥è‡ªå®šç¾©ã€‚
```javascript
<MultiRangeSlider min={periodConfig.min} max={periodConfig.max} name="period"
    onChange={onRangeChange}
    format={val => {
    const hour = (Math.floor(periodConfig.hoursHandler(val))).toString().padStart(2, '0')
    const minute = (periodConfig.minutesHandler(val)).toString().padStart(2, '0')
    return `${hour}:${minute}`
    }}/>
```
é…åˆå¦å¤–ä¸€éš»å‡½å¼ï¼Œå°‡ unixTimestamp è½‰æ›ï¼Œæ”¾å…¥è³‡æ–™çš„ properties è£¡é¢ï¼Œè®“ä¹‹å¾Œå¯ä»¥ç¯©é¸ã€‚å…©è€…ä¸€èµ·å°±å¯ä»¥å®¹æ˜“åœ°èª¿æ•´æˆ by hour or by minute çš„ç¯©é¸æ–¹å¼ã€‚

```javascript
export const unixTimestampToTimeOfDate = (unixTimestamp: number, unit:TimeUnit = 'minute') => {
    const datetime = new Date(unixTimestamp * 1000)
    const hours = datetime.getHours()
    const minutes = datetime.getMinutes()
    if (unit === 'minute') return hours * 60 + minutes
    if (unit === 'hour') return hours
}
```

æ ¹æ“š time unit ç”¢ç”Ÿ config è¨­ç½®
```typescript
const periodUnit: TimeUnit = 'hour'
const periodConfig = ((unit: TimeUnit): periodConfig => {
  const periodConfigs = {
    hour: {
      min: 0,
      max: 24,
      unit: 'hour',
      hoursHandler: (v: number) => v,
      minutesHandler: (v: number) => 0
    } as periodConfig,
    minute: {
      min: 0,
      max: 60 * 24,
      unit: 'hour',
      hoursHandler: (v: number) => v / 60,
      minutesHandler: (v: number) => v % 60
    } as periodConfig,
  }
  return periodConfigs[unit]
})(periodUnit)
```

#### åˆæ­¥ä½¿ç”¨ React + TypeScript çš„å¿ƒå¾—

React 16.8 ä¹‹å¾Œï¼Œå°±ä¸ç”¨å¯« Class äº†ï¼Œä¸€å¾‹å¯« Functional Component å³å¯ã€‚è¦æ³¨æ„ state ä¸æœƒç«‹å³æ›´æ–°ï¼Œæœƒç­‰åˆ° comonentDidUpdate ä¹‹å¾Œæ‰æœƒæ›´æ–°ï¼Œä¸€èˆ¬è¦å¯« Callback æˆ–æ˜¯ä½¿ç”¨ useEffect å»ç›£è½ state çš„è®ŠåŒ–ã€‚è©³ç´°å¯ä»¥çœ‹å®˜ç¶²æˆ–æ˜¯é€™ç¯‡ [Why React doesnâ€™t update state immediately](https://blog.logrocket.com/why-react-doesnt-update-state-immediately/)ã€‚ä»¥åŠåœ¨ React ä¸­ï¼Œçµ„ä»¶è¦å½±éŸ¿çˆ¶å±¤çµ„ä»¶çš„è©±ï¼Œç¿’æ…£æ˜¯ç›´æ¥å‚³å…¥å‡½å¼çµ¦å­çµ„ä»¶ï¼Œè€Œä¸æ˜¯ç”±å­çµ„ä»¶ Emit Event å‡ºä¾†çµ¦çˆ¶å±¤ã€‚React çš„å¯¦è¸æ–¹å¼è·Ÿæœ€ä½³è§£ï¼Œéš¨è‘—ç‰ˆæœ¬è¿­ä»£ï¼Œæœ‰å¾ˆå¤šä¸åŒï¼ŒæŸ¥æ‰¾è³‡æ–™æ™‚è¦ç‰¹åˆ¥æ³¨æ„ã€‚ä¾‹å¦‚[é€™ç¯‡](https://pjchender.blogspot.com/2020/07/typescript-react-using-typescript-in.html)æåˆ°çš„ï¼Œä¸å†å»ºè­°ä½¿ç”¨ React.FCã€‚

TypeScript ä¸€é–‹å§‹ç”¨æœƒéå¸¸ä¸ç¿’æ…£ï¼Œå› ç‚ºæœ‰å¥½å¤šæ±è¥¿ä¸ç†Ÿæ‚‰ï¼Œä¸å…ˆææ‡‚ Code å°±æœƒå‹•ä¸äº†ã€‚å®šç¾©å‡½å¼è·Ÿè¤‡é›œçš„è³‡æ–™çµæ§‹çš„å‹åˆ¥æ™‚ï¼Œæ¯”è¼ƒè¤‡é›œï¼Œé‚„è¦å¤šç†Ÿæ‚‰æƒ…å¢ƒæ‡‰ç”¨è·Ÿ TypeScript çš„åŠŸèƒ½ã€‚

- useState é€™å€‹ Hook çš„å‹åˆ¥å®šç¾©å¯ä»¥äº†è§£ä¸€ä¸‹
- æœ‰å¾ˆå¤šåŸç”Ÿå¸¸ç”¨çš„æ ¼å¼ï¼Œä¾‹å¦‚ HTML çš„ Input Change Eventï¼Œé€é IDE æ»‘é¼ ç§»ä¸Šå»å¯ä»¥çœ‹å‹åˆ¥å®šç¾©ã€‚
- [React TypeScript Cheatsheet](https://react-typescript-cheatsheet.netlify.app/) å¾ˆæœ‰å¹«åŠ©ï¼
- Compoenent Props è·Ÿ default value çš„å®šç¾©æ–¹å¼ï¼Œåœ¨çœ‹äº†[é€™ç¯‡](https://react-typescript-cheatsheet.netlify.app/docs/basic/getting-started/default_props)è·Ÿ[é€™ç¯‡](https://pjchender.blogspot.com/2020/07/typescript-react-using-typescript-in.html)è·Ÿ[é€™ç¯‡](https://stackoverflow.com/questions/37282159/default-property-value-in-react-component-using-typescript)ä¹‹å¾Œï¼Œè‡ªå·±ç›®å‰æ˜¯é€™æ¨£å¯«ï¼š

``` typescript
interface MultiRangeSliderProps {
    min?: number
    max?: number 
    onChange?: (min: number, max: number) => void
    format?: (val: number) => string
}
const MultiRangeSlider = ({
    min: defaultMin = 0,
    max: defaultMax = 60 * 24,
    onChange,
    format
}: MultiRangeSliderProps) => {
    const [min, setMin] = useState<number>(defaultMin)
    const [max, setMax] = useState<number>(defaultMax)
    ...
}
```

#### å…¶ä»–æ”¶ç©«
- [å­—ç¬¦ä¸²è£œå…¨å¯ç”¨ padStart, padEnd](https://kknews.cc/code/empkroq.html)
- [ES6 exporting/importing in index file](https://stackoverflow.com/questions/34072598/es6-exporting-importing-in-index-file)
- [ä¸è¦ç›´æ¥æ”¹è®Š state](https://stackoverflow.com/questions/37755997/why-cant-i-directly-modify-a-components-state-really)

### Day 3

#### æ”¹ checkbox çš„åŸç”Ÿæ¨£å¼
å¸Œæœ›æ¨£å¼çµ±ä¸€ï¼Œå°±æƒ³è‘—ä¹ŸæŠŠ checkbox æ”¹ä¸€ä¸‹æ¨£å¼ï¼Œå°±é–‹å§‹ç ”ç©¶æ€éº¼ä¿®æ”¹åŸç”Ÿ checkbox çš„ styleï¼Œä¸»è¦æ€è·¯åƒè€ƒ[é€™ç¯‡](https://stackoverflow.com/questions/4148499/how-to-style-a-checkbox-using-css)ï¼Œä½†å¯¦éš›æ¨£å¼è‡ªå·±æ”¹äº†ä¸€ç‰ˆã€‚æ–¹æ³•æ˜¯æŠŠåŸç”Ÿçš„è—èµ·ä¾†ï¼Œç„¶å¾Œç”¨å½å…ƒç´  :before ç•«ä¸€å€‹æ–°çš„ï¼Œæœ‰é€™å¹¾ç¨®ç‹€æ…‹è®ŠåŒ–ï¼š :checked, :disabled, :not(:disabled):hoverã€‚
- è—èµ·ä¾†ç¾åœ¨å¯ä»¥ä½¿ç”¨ appearance: none å¯¦ç¾ï¼Œæ¯”è¼ƒç°¡å–®ã€‚
- å½å…ƒç´ çš„æ¨£å¼èª¿æ•´èµ·ä¾†å¥½ä¸é †ï¼Œä¸»è¦å¡åœ¨äº† content æœ‰å€¼è·Ÿæ²’å€¼æ™‚ï¼Œé«˜åº¦ä¸€ç›´è®Šä¾†è®Šå»ï¼Œå¾Œä¾†å—ä¸äº†ï¼Œç›´æ¥éƒ½è®“ä»–æœ‰å€¼ï¼Œæ”¹ç”¨æ–‡å­—é¡è‰²æ§åˆ¶å‹¾å‹¾çš„é¡¯ç¤ºèˆ‡å¦ã€‚

#### åšä¸€å€‹ Panel Component
é€™å€‹å¾ˆç°¡å–®ï¼Œä¸»è¦æ˜¯è¦äº†è§£ Vue çš„ slot åœ¨ React ä¸­çš„å¯¦ç¾æ€è·¯ã€‚React æœ¬èº«æœƒæŠŠè¢« Component åŒ…èµ·ä¾†çš„ JSX å‚³å…¥è©² Componentï¼Œå¯ä»¥å¾ Props.children å–å¾—ï¼Œç„¶å¾Œç›´æ¥ Render å‡ºä¾†ã€‚å°±é€™å€‹ç¯„ä¾‹ä¾†èªªï¼Œåªéœ€è¦äº†è§£ children çš„ type å°±å¥½äº†ã€‚åƒè€ƒ[é€™ç¯‡](https://www.carlrippon.com/react-children-with-typescript/)ï¼Œç›´æ¥å®šç¾©ç‚º ReactNode å°±å¥½ã€‚
```typescript
interface PanelProps {
    title?: string,
    children?: React.ReactNode,
}
const Panel = ({ title = '', children }: PanelProps) => {
    return <div className="my-2">
        <legend className="text-lg pt-2 pb-4">{title}</legend>
        {children}
    </div>
}
```

#### ç¬¬ä¸€æ¬¡ç”¨ mapbox ä½œåœ°åœ–å‘ˆç¾!

æœ‰å…©ç¨®ä½œæ³•ï¼Œä¸€ç¨®æ˜¯åƒè€ƒå®˜ç¶²çš„æ–‡ä»¶ç›´æ¥ç”¨ mapbox-gl å¯¦ä½œï¼Œä¸€ç¨®æ˜¯ç”¨ react-map-glã€‚é€™è£¡ä½¿ç”¨ react-map-gl ä¾†å»ºæ§‹ï¼Œé …ç›®æ˜¯ Uber çš„åœ˜éšŠå»ºç«‹çš„ï¼Œä¸»è¦æ˜¯ç”¨èµ·ä¾†æ¯”è¼ƒæ–¹ä¾¿ï¼Œç¼ºé»æ˜¯ç›¸é—œè³‡æ–™è¼ƒå°‘ï¼Œå¾ˆå®¹æ˜“éƒ½åªæœå°‹åˆ° mapbox-gl çš„ç¯„ä¾‹ï¼Œä¸è«–æ˜¯å“ªå€‹ï¼Œå…¶å¯¦æ¯”è¼ƒé è­œçš„é‚„æ˜¯åªæœ‰å®˜æ–¹çš„ Docs è·Ÿ Examplesï¼Œä¸€æ—¦å®˜ç¶²æ²’æåˆ°ï¼Œå°±æœ‰é»é›£æŸ¥ã€‚

ç…§è‘—ç¯„ä¾‹å»ºç«‹ Mapï¼Œç¬¬ä¸€å€‹ç¯„ä¾‹åƒè€ƒ[é€™å€‹](https://visgl.github.io/react-map-gl/docs/api-reference/map)

é¦–å…ˆè¦å…ˆæœ‰ mapboxAccessTokenï¼Œå» mapbox å®˜ç¶²è¨»å†Šå³å¯ï¼Œç„¶å¾Œå°‡ token æ”¾åœ¨ç’°å¢ƒè®Šæ•¸è£¡å‚³å…¥ã€‚[é€™è£¡](https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens)å¯«èªªå¯ä»¥ç›´æ¥å»ºç«‹ç’°å¢ƒè®Šæ•¸å°±å¯ä»¥ç”¨äº†ï¼Œä½†æˆ‘å€‘ç”¨çš„æ˜¯ Next.jsï¼Œå®ƒå®šç¾©çš„é‚£å…©å€‹åç¨±ä¸èƒ½ç›´æ¥æŠ“åˆ°ï¼Œæ‰€ä»¥å°±ä¹–ä¹–è‡ªå·±å‚³å…¥äº†ã€‚åƒè€ƒ[Next.js å®˜ç¶²èªªæ˜](https://www.nextjs.cn/docs/basic-features/environment-variables)è¨­å®šï¼Œæš´éœ²çµ¦ç€è¦½å™¨ï¼Œå°±å¯ä»¥åœ¨ process.env åº•ä¸‹å–å¾—ä½ çš„è®Šé‡äº†ã€‚

mapStyle å¯ä»¥æŒ‘è‡ªå·±å–œæ­¡çš„ï¼Œæœ‰ [online gallery](https://www.mapbox.com/gallery/)ï¼Œä½†é€£çµåˆ°åº•åœ¨å“ª ğŸ™„

ç…§è‘—[é€™è£¡](https://visgl.github.io/react-map-gl/docs/api-reference/map)è¨­ç½®ä¸€äº›äº‹ä»¶ï¼Œç•¶ä½¿ç”¨è€…ç§»å‹•ã€ç¸®æ”¾çš„æ™‚å€™å¯ä»¥å–å¾— viewState çš„è®ŠåŒ–ï¼Œåšç›¸å°æ‡‰çš„äº‹æƒ…ã€‚æˆ–æ˜¯é€é vscode ç›´æ¥è·³é€²å»çœ‹ react-map-gl çš„åŸå§‹ç¢¼ä¹Ÿå¯ä»¥ï¼Œé€™æ™‚å€™å¿½ç„¶ç™¼ç¾ TypeScript çš„å¥½è™•å°±æ˜¯æŸ¥æ‰¾åŸå§‹ç¢¼çš„å®šç¾©å¾ˆæ–¹ä¾¿ï¼Œç¼ºé»å°±æ˜¯ä¸€å®šè¦æ‰“ç ´æ²™é‹å•åˆ°åº•ï¼ŒæŠŠæ ¼å¼å®šç¾©ç¢ºèªæ¸…æ¥š code æ‰èƒ½å‹•ï¼Œæèµ·ä¾†ä¹Ÿæ˜¯è²»å‹ã€‚

ä¸€é–‹å§‹é‚„ä¸å¤ªçŸ¥é“ä¸€äº›è¦ç”¨çš„ Type è¦å»å“ªè£¡å¼•å…¥ï¼Œæ‰¾äº†åŠå¤©ï¼ŒåŸä¾†å¤§éƒ¨åˆ†éƒ½å¯ä»¥ç›´æ¥å¾ react-map-gl ç›´æ¥å–å¾—ã€‚

```typescript
import { Map, ViewStateChangeEvent, Source, SourceProps, Layer, LayerProps } from 'react-map-gl'
```

é–‹å§‹æº–å‚™æŠŠè³‡æ–™ä¸Ÿåˆ° Map è£¡ï¼Œé¦–å…ˆæ˜¯æ€éº¼æ”¾å…¥è³‡æ–™ï¼Ÿ mapbox-gl çš„è¨­è¨ˆä¸Šï¼Œè³‡æ–™æ˜¯é€é addSource æ”¾å…¥ Mapï¼Œ Source æ˜¯å°ˆé–€æä¾›è³‡æ–™ç”¨çš„ï¼Œè¦é¡¯ç¤ºçš„è©±ï¼Œè¦å¦å¤–è¨­ç½® Style Layer å»é¡¯ç¤ºï¼Œå¥½è™•æ˜¯åŒä¸€å€‹ Source å°±å¯ä»¥ç”¨ä¸åŒçš„é¡¯ç¤ºæ–¹å¼å‘ˆç¾ï¼Œç¯„ä¾‹å¦‚[é€™å€‹](https://docs.mapbox.com/mapbox-gl-js/example/geojson-line/)ï¼Œç„¶å¾Œ react-map-gl çš„ç¯„ä¾‹æ˜¯[é€™å€‹](https://visgl.github.io/react-map-gl/docs/api-reference/source)ï¼Œè©³ç´°è§£èªªå¯ä»¥çœ‹[é€™ç¯‡](https://www.lostcreekdesigns.co/writing/a-complete-guide-to-sources-and-layers-in-react-and-mapbox-gl-js/)ã€‚

æ¥è‘—å®šç¾©è³‡æ–™ï¼Œçœ‹ç¯„ä¾‹åŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨ GeoJSON ï¼Œä¸€ç¨®å°ˆé–€è™•ç†åœ°ç†è³‡è¨Š(GIS) çµæ§‹çš„JSON æ¨™æº–æ ¼å¼ã€‚å¾ Map çš„å®šç¾©è£¡é¢å¾€ä¸‹æŸ¥æ‰¾ï¼Œå¯ä»¥ç™¼ç¾ GeoJSON é€™å€‹æ ¼å¼å®šç¾©ï¼Œé€™å€‹æª”æ¡ˆå¯¦é«”ä¸Šæ˜¯æ”¾åœ¨ node_modules/@types/geojson/index.d.tsï¼Œé‚£è¦æ€éº¼å¼•å…¥å‘¢ï¼Ÿç›´æ¥ import from 'geojson'ï¼ŒåŸç†çœ‹é€™å€‹ [How TypeScript resolves modules](https://www.typescriptlang.org/docs/handbook/module-resolution.html#how-typescript-resolves-modules)
```typescript
import { FeatureCollection } from 'geojson'
```

çµ‚æ–¼å¯ä»¥åœ¨åœ°åœ–ä¸Šé¡¯ç¤ºå‡ºè³‡æ–™é»äº†ï¼

#### å…¶ä»–å°æ”¶ç©«
- [HTML fieldset](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/fieldset)
- [Types vs. interfaces in TypeScript](https://blog.logrocket.com/types-vs-interfaces-in-typescript/)
    - Interfaces are better when you need to define a new object or method of an object.
    - Types are better when you need to create functions.

### Day 4
é–‹å§‹è©¦è‘—æŠŠæ‰€æœ‰è³‡æ–™éƒ½é¡¯ç¤ºå‡ºä¾†ï¼Œä¸¦ä¸”æ ¹æ“šè³‡æ–™åšäº›é¡¯ç¤ºä¸Šçš„å·®ç•°ã€‚ç¬¬ä¸€æ˜¯è¦å¦‚ä½•æ¯”è¼ƒå¥½çš„é€²è¡Œè³‡æ–™å‘ˆç¾çš„åˆå§‹åŒ–ï¼Ÿç¬¬äºŒå€‹å•é¡Œæ˜¯æ ¹æ“šè³‡æ–™ä¸åŒæ”¹è®Šé¡¯ç¤ºæ–¹å¼ã€‚

#### åˆå§‹çš„ viewState è¦å¦‚ä½•ä¸å¯«æ­»ï¼Œè€Œæ˜¯æ ¹æ“šè³‡æ–™è‡ªå‹•é€²è¡Œåˆå§‹åŒ–ï¼Ÿ
ä¸€é–‹å§‹å…ˆè‡ªå·±ç®—ä¸­å¿ƒé»ï¼Œä½†é€™æ¨£ä¸å®¹æ˜“è¨ˆç®—æ­£ç¢ºçš„ zoom æ˜¯å¤šå°‘ï¼Œæ„Ÿè¦ºé€™æ‡‰è©²æ˜¯å¾ˆå¸¸è¦‹çš„éœ€æ±‚ï¼Œæ–¼æ˜¯é–‹å§‹æ‰¾ç¯„ä¾‹ã€‚é¦–å…ˆå¯ä»¥å…ˆçœ‹çœ‹[é€™å€‹](https://visgl.github.io/react-map-gl/examples/zoom-to-bounds)ï¼Œé€²å» github çœ‹ code ç”¨åˆ°äº†å¹¾å€‹æ±è¥¿ï¼Œç¬¬ä¸€å€‹æ˜¯ Map çš„ Prop initialViewStateï¼Œç¬¬äºŒå€‹æ˜¯ mapRef.current.fitBounds é€™å€‹æ–¹æ³•ã€‚ä½†é€™å€‹ç¯„ä¾‹æ˜¯è¦é»æ“Šä¹‹å¾Œï¼Œæ‰è‡ªå‹•æ ¹æ“šçµ¦äºˆçš„ Bounds é€²è¡Œ fitï¼Œä½†æˆ‘å€‘å¸Œæœ›çš„æ˜¯ init çš„æ™‚å€™ä¾¿è‡ªå‹•æ ¹æ“šè³‡æ–™é€²è¡Œ fitã€‚ç„¶å¾Œæ‰¾åŠå¤©æœ€å¾Œä¹–ä¹–å»çœ‹ Map çš„å®šç¾©ï¼Œç™¼ç¾ initialViewState æœ‰æ“´å……é€™å…©å€‹ props: bounds è·Ÿ fitbBoundsOptionsï¼Œæ–¼æ˜¯å†å›å»å®˜ç¶²æ–‡ä»¶çœ‹é€™å…©å€‹çš„è§£é‡‹ï¼Œåœ¨[é€™è£¡](https://visgl.github.io/react-map-gl/docs/api-reference/map#initialviewstate)ï¼Œä¸å¤ªå¥½æ‰¾ã€‚

åŸºæœ¬ä¸Šå°±æ˜¯è¦æä¾›ä¸€çµ„ç¯„åœé‚Šç•Œï¼Œtype å¯ä»¥ç›´æ¥å¾ react-map-gl å¼•å…¥ï¼Œæœ‰å…©ç¨®æ”¯æ´çš„æ ¼å¼å¦‚ä¸‹ï¼š
```javascript
    // ç¬¬ä¸€ç¨®
    // ç¬¬ä¸€ä½æ”¾ sw, æœ€è¥¿å—çš„åº§æ¨™
    // ç¬¬äºŒä½æ”¾ ne, æœ€æ±åŒ—çš„åº§æ¨™
    [[longitude, latitude],[longitude, latitude]] 
    // ç¬¬äºŒç¨®
    // æ±å—è¥¿åŒ—éƒ½æ˜¯æ•¸å­—ï¼Œæ‡‰è©²ä¹Ÿæ˜¯ç¶“ç·¯åº¦çš„å››å€‹æœ€å¤§ã€æœ€å°å€¼
        [west, south, east, north] 
```

æ¥è‘— fitbBoundsOptions å¯ä»¥æ”¾ä¸€äº›å…¶ä»–çš„è¨­å®šï¼Œé€™è£¡åªç”¨äº† paading è€Œå·²ã€‚æœ€å¾Œæ ¹æ“šè³‡æ–™è‡ªå·²ç®—ä¸€ä¸‹ bounds çš„å››å€‹å€¼ï¼Œä¸€èµ·ä¸Ÿå…¥å³å¯ã€‚

#### mapRef
ä¹‹å¾Œå¯¦ä½œäº’å‹•ï¼Œæ‡‰è©²é‚„æ˜¯éœ€è¦ç”¨åˆ° map çš„ refï¼Œæ‰€ä»¥ä¹Ÿå…ˆè¨­ç½®èµ·ä¾†ã€‚ä½† useRef<MapRef>()ï¼Œç¶ä¸Šå» map çš„ ref æ™‚ï¼Œä¸€ç›´å‘Šè¨´æˆ‘å‹åˆ¥éŒ¯èª¤ï¼Œå¾Œä¾†åˆå§‹åŒ–æ”¾äº† null é€²å»å°±å¯ä»¥äº†ï¼Œç¸½è¦ºå¾—æ€ªæ€ªçš„ï¼Œä½†å…ˆé€™æ¨£ã€‚

```typescript
    const mapRef = useRef<MapRef>(null)
    return <Map ref={mapRef} />
```

#### æ¥ä¸‹ä¾†æ˜¯æ ¹æ“šè³‡æ–™æ”¹è®Š circle çš„é¡è‰²ï¼
é¦–å…ˆæ ¹æ“šæ ¼å¼å®šç¾©å°‡å…¶ä»–å±¬æ€§æ”¾åˆ° properties è£¡é¢ï¼Œç„¶å¾Œç…§è‘—é€™å€‹[ç¯„ä¾‹](https://docs.mapbox.com/mapbox-gl-js/example/data-driven-circle-colors/)å­¸ç¿’è¨­ç½®ï¼Œä¸»è¦å°±æ˜¯çœ‹ paint çš„éƒ¨åˆ†ï¼Œç„¶å¾Œå»æ‰¾ react-map-gl å°æ‡‰çš„è¼¸å…¥æ ¼å¼å®šç¾©å³å¯ï¼Œä½†æˆ‘å¡æœ€ä¹…çš„é‚„æ˜¯åœ¨ TypeScript çš„å„ç¨®å ±éŒ¯ï¼Œç•¶ç”¨ä¸€äº› function å»å‹•æ…‹ç”¢ç”Ÿ props çš„æ™‚å€™ï¼Œé‡åˆ°äº†è¨±å¤šæ¬¡æ²’æœ‰æ­£ç¢ºå®šç¾©å¥½æ ¼å¼çš„ç‹€æ³ï¼Œå°è‡´ä¸€ç›´éœ€è¦å»æŸ¥çœ‹ç´°ç¯€çš„æ ¼å¼å®šç¾©æ˜¯ä»€éº¼ï¼Œç„¶å¾Œä¹–ä¹–å®šç¾©å¥½å„å€‹æ­¥é©Ÿä¹‹é–“çš„è¼¸å…¥è·Ÿè¼¸å‡ºçš„ typeï¼Œä¸èƒ½æœ‰è¡çªï¼Œé€™éƒ¨åˆ†æ»¿éœ€è¦åŠ å¼· TypeScript çš„åŸºç¤æ¦‚å¿µçš„ã€‚

ç„¶å¾Œå°å…¥ tailwind çš„ colorsï¼Œå‹•æ…‹ç”¢ç”Ÿä¸åŒé¡åˆ¥çš„å°æ‡‰é¡è‰²æ™‚é‚„ä¸€ç›´å ±éŒ¯ï¼Œä¸»è¦å°±æ˜¯ç•¶æˆ‘å€‘ä½¿ç”¨ Object.keys() å° Object é€²è¡Œ for loop æ“ä½œæ™‚ï¼Œä½¿ç”¨ obj[key] å»å–å¾—å°æ‡‰å€¼æ™‚ï¼ŒTypeScript å°±æœƒå ±éŒ¯ï¼ŒåŸå› æ˜¯ string é€™å€‹ Type ä¸èƒ½ç•¶ä½œç´¢å¼•ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘éœ€è¦çŸ¥é“ é€™äº› Keys é™¤äº† string ä¹‹å¤–çš„åˆæ³• Typeã€‚è§£æ±ºæ–¹æ³•æ˜¯ï¼Œå…ˆç”¨ typeof å–å¾— Ojbect æ‰€æœ‰çš„ typesï¼Œç„¶å¾Œå†ç”¨ keyof å°‡å…¶è½‰æ›æˆ union of literal typesï¼Œå°±æ˜¯ Keys çš„ Type äº†ï¼Œè©³ç´°å¯ä»¥çœ‹[é€™ç¯‡](https://stackoverflow.com/questions/57086672/element-implicitly-has-an-any-type-because-expression-of-type-string-cant-b)è·Ÿ[é€™ç¯‡](https://juejin.cn/post/7023238396931735583)

#### å¯¦ç¾ Tooltip
åŸºæœ¬ä¸Šç”¨ react-map-gl çš„ [Popup](https://visgl.github.io/react-map-gl/docs/api-reference/popup) æ­é… Map çš„ [onMouseMove](https://visgl.github.io/react-map-gl/docs/api-reference/map#onmousemove) ä¸€èµ·å¯¦ç¾ã€‚å¦å¤–åŒ…äº†ä¸€å€‹ Tooltipï¼Œè£¡é¢çš„ Content ç”±å¤–éƒ¨æä¾›ã€‚æœ‰ä¸€å€‹åœ°æ–¹è¦æ³¨æ„ï¼Œåœ¨ Map è¦æŒ‡å®š interactiveLayerIds ï¼Œé€™è£¡è¦æ”¾æˆ‘å€‘ç•« Point çš„ Layer IDã€‚ä¸Šé¢æœ‰è¨­ç½®çš„è©±ï¼Œevent è£¡é¢å°±æœƒæœ‰ä¸€æˆ–å¤šå€‹å« [Feature](https://docs.mapbox.com/help/glossary/features/) çš„æ±è¥¿ï¼Œå°±æ˜¯æˆ‘å€‘ç¾åœ¨ç¢°åˆ°çš„ Pointsã€‚ç„¶å¾Œå°‡ç•¶å‰çš„åº§æ¨™ä½ç½®è¨˜éŒ„ä¸‹ä¾†ï¼Œå‚³çµ¦ tooltip è®“ä»–çŸ¥é“è¦åŸºæ–¼å“ªå€‹åº§æ¨™é¡¯ç¤ºã€‚

ç”¨ Popup çš„æ™‚å€™ï¼Œä»–åˆå§‹çš„ä½ç½®è€æ˜¯è·‘åœ¨å¾ˆå¥‡æ€ªçš„åœ°æ–¹ï¼Œæä¸å¤ªæ‡‚ç‚ºä»€éº¼ï¼Œå¾Œä¾†å°±è‡ªå·±åŠ  CSS è™•ç†äº†ã€‚

```javascript
<Popup
    longitude={position[0]}
    latitude={position[1]}
    offset={[4, -12]}
    anchor="bottom"
    maxWidth={maxWidth}
    className="fixed top-0 left-0 transform-none ..."
/>
```

ç„¶å¾Œå°±æ˜¯ onMouseMove å¾—åˆ°çš„åº§æ¨™æœƒæ˜¯ç•¶å‰æ»‘é¼ çš„ä½ç½®ï¼Œå¦‚æœæŠŠé€™å€‹ç›´æ¥å‚³çµ¦ tooltipï¼Œå°±æœƒç™¼ç”Ÿ Tooltip æœ‰é»é£„é›¢ Point çš„æ„Ÿè¦ºã€‚æ‰€ä»¥å¾Œä¾†å°±åŠ äº†ä¸€å±¤åˆ¤æ–·ï¼Œå¦‚æœç•¶å‰çš„ Feature è·Ÿ ä¹‹å‰çš„ä¸€æ¨£ï¼Œå°±ä¸è¦æ”¹è®Šä½ç½®ï¼Œä¸¦ä¸”æ”¹å¾ Feature è£¡é¢æ‹¿ä»–çš„åº§æ¨™ï¼Œä¸Ÿçµ¦ Tooltipã€‚ç‚ºäº†æ–¹ä¾¿åˆ¤æ–·ï¼Œæˆ‘å€‘è¼¸å…¥ Source çš„æ™‚å€™ï¼Œå°‡ generateId è¨­ç‚º true, å°±å¯ä»¥æ¯”è¼ƒå‰å¾Œçš„ feature.id æ˜¯å¦ä¸€è‡´ã€‚

```typescript
const [showTooltip, setShowTooltip] = useState(false)
const [lastId, setLastId] = useState<number | null>(null)
const [tooltipPosition, setTooltipPosition] = useState<Position>([0, 0])

const onMouseMove: (evt: MapLayerMouseEvent) => void = evt => {
    const newFeature: Feature | undefined = evt.features && evt.features[0]
    if (newFeature === undefined) return toggleTooltip(false)
    if (newFeature.id === lastId) return
    const featureId: Feature['id'] = newFeature.id
    const properties: HoverInfo['properties'] = newFeature.properties || {}
    const [lon, lat]: Position = (newFeature.geometry as Point).coordinates
    const geoJsonProperties = newFeature as GeoJsonProperties
    const circleColor = geoJsonProperties && geoJsonProperties.layer.paint['circle-color']
    setTooltipPosition([lon, lat])
    setLastId(newFeature.id as number)
    toggleTooltip(true, { lon, lat, properties, featureId, circleColor })
}

```

#### å…¶ä»–æ”¶ç©«
- [How to import a JSON file in JavaScript (ES6 Modules)](https://bobbyhadz.com/blog/javascript-import-json-file)
- ç¶“ç·¯åº¦çš„è³‡æ–™é€šå¸¸æ˜¯é•·é€™æ¨£
    ```
    [longitude: max/min +180 to -180,
    latitude: max/min +90 to -90]
    ```

### Day 5 & 6

ä¸»è¦å°±æ˜¯åšè®“æ§åˆ¶é … (Filter) ç”Ÿæ•ˆå»å½±éŸ¿åœ°åœ–ä¸Šå‡ºç¾çš„è³‡æ–™ï¼Œä»¥åŠæ•´ç† Codeï¼Œèª¿æ•´ä¸€äº›ç´°ç¯€ã€‚ç¬¬ä¸€é»æœ¬èº«ä¸é›£åšï¼Œå°±æ˜¯è¦çœ‹ä¸€ä¸‹æ–‡æª”æä¾›å“ªäº›æ–¹æ³•ï¼Œç¬¬äºŒé»ä¸»è¦æ˜¯æ€è€ƒå¦‚ä½•å°‡é‚è¼¯æ‹†åˆ†ï¼Œå„å¸ä½•è·ã€‚

#### è®“æ§åˆ¶é …å¯ä»¥ç¯©é¸è³‡æ–™
çœ‹ä¸€ä¸‹å®˜ç¶²ï¼Œmapbox-gl æœ‰æä¾› Filter çš„åŠŸèƒ½ï¼Œé‡å° Layerï¼Œå¯ä»¥ç”¨ä»–çš„ expressions çš„å½¢å¼è¼¸å…¥ç¯©é¸æ¢ä»¶ï¼Œå°±åªæœƒå‘ˆç¾ç¯©é¸å¾Œçš„è³‡æ–™äº†ã€‚[æ–‡æª”](https://docs.mapbox.com/help/glossary/filter/)çš„ç¯„ä¾‹å¦‚ä¸‹ï¼š
```javascript
map.addLayer({
  id: layerID,
  type: 'symbol',
  source: 'places',
  layout: {
    'icon-image': symbol + '-15',
    'icon-allow-overlap': true
  },
  filter: ['==', 'icon', symbol]
});
```
æˆ‘å€‘çš„æƒ…å¢ƒä¸‹ï¼Œæœ‰å…©å€‹ä»¥ä¸Šçš„æ¢ä»¶ä¸¦å­˜ï¼Œæ‰€ä»¥é‚„è¦çœ‹å¤šæ¢ä»¶çš„è¡¨é”æ–¹å¼ï¼Œ[æ–‡æª”](https://docs.mapbox.com/mapbox-gl-js/style-spec/other/#other-filter)åœ¨é€™ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š
```javascript
[
    "all",
    ["==", "class", "street_limited"],
    [">=", "admin_level", 3],
    ["!in", "$type", "Polygon"]
]
```
ç„¶å¾Œ react-map-gl ä¹Ÿæœ‰æ”¯æ´ï¼Œä¾æ¨£ç•«è‘«è˜†è¼¸å…¥å³å¯ï¼Œ[æ–‡æª”](https://visgl.github.io/react-map-gl/docs/api-reference/layer)åœ¨æ­¤ã€‚

å› æ­¤æˆ‘å€‘çš„æµç¨‹å°±æ˜¯ï¼š
1. ä½¿ç”¨è€…å¾ UI ä¸Šæ”¹è®Šæ¢ä»¶
2. å°‡æ¢ä»¶è½‰æ›æˆ mapbox-gl çš„ expressions æ ¼å¼
3. ç”¨ setState ç´€éŒ„ filter æ¢ä»¶ç‹€æ…‹
4. ç¶åˆ° Layer çš„çµ„ä»¶ä¸Š

æœ€éº»ç…©çš„æ˜¯ç¬¬äºŒé»ï¼Œé‚£å€‹ expressions çš„æ ¼å¼æ¯”è¼ƒè¤‡é›œä¸€é»ï¼Œæˆ‘å€‘åšäº†ä¸€å€‹å°å¹«æ‰‹ filterProducer å¹«æˆ‘å€‘ã€‚å°å¹«æ‰‹æä¾›å¢åŠ è·Ÿæ¸›å°‘æ¢ä»¶çš„æ–¹æ³•ï¼Œå›å‚³æœ€çµ‚çµ„åˆå‡ºçš„ expressionsã€‚å…§éƒ¨æœƒå°‡æ¢ä»¶å­˜è‘—ï¼Œä¸¦è™•ç†ä¸€äº›æ ¼å¼ä¸Šçš„å·®ç•°ã€‚ä½¿ç”¨ä¸Šåƒé€™æ¨£ï¼š
```javascript
/**
 * 
 * @param idx æ¢ä»¶è¦æ”¾åœ¨ç¬¬å¹¾ä½ï¼Œå¦‚æœå°åŒæ¨£ä½å­å¢åŠ æ¢ä»¶çš„è©±ï¼Œæœƒè¦†å¯«è©²ä½å­çš„æ¢ä»¶ã€‚
 * @param args å¾Œé¢è¦ç…§ expression çš„é †åºæ”¾å…¥ï¼Œæœ‰å…©ç¨®ä¸åŒçš„ç‹€æ³ï¼Œå¦‚æœæ²’æœ‰ keyï¼Œå°±æ”¾å…¥ undefinedã€‚
 *  1. operator, property key, value1, value2 ,...
 *  2. operator, value1, value2, ...
 * @returns 
 */
filterProducer.addFilter(1, 'in', 'country', ...['Taiwan', 'US'])
filterProducer.addFilter(2, '>=', 'timeOfDate', 300)
filterProducer.addFilter(3, '<=', 'timeOfDate', 1000)
```

æ¥ä¸‹ä¾†å°±æ˜¯è¦æŠŠä¸€äº›æ¥å£æ‹‰å‡ºä¾†çµ¦å¤–éƒ¨æ§åˆ¶ä½¿ç”¨ã€‚é€™è£¡å°±é–‹å§‹æ¶‰åŠåˆ°è¦æ€éº¼æ‹†åˆ†çš„å•é¡Œï¼Œæœ€ä¸»è¦æ˜¯è®“ ScactterMap è·Ÿè³‡æ–™è§£è€¦ï¼Œä¸ç„¶æ›ä¸€ä»½è³‡æ–™ï¼Œé€™å€‹ Component åŸºæœ¬ä¸Šå°±ä¸èƒ½ç”¨äº†ï¼Œå¾©ç”¨æ€§å¤ªç³Ÿã€‚æœ€çµ‚æˆ‘å€‘å®šç¾©çš„ä»‹é¢å¦‚ä¸‹ï¼Œé‚„å¯ä»¥æ›´å¥½ï¼Œä½†éœ€è¦å†æ·±å…¥å¤šçœ‹ä¸€ä¸‹ TypeScriptã€‚

æˆ‘å€‘æœŸå¾… data çš„æ ¼å¼æ˜¯ array of objectsï¼Œè‡³æ–¼ objects è£¡é¢æœ‰å“ªäº› propertiesï¼Œæˆ‘å€‘å¸Œæœ› ScactterMap ä¸éœ€è¦çŸ¥é“ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼Œç•¶è¦æ“ä½œé€™äº› properties æ™‚ï¼Œå°±æœƒéœ€è¦ä½¿ç”¨è€…æä¾›æ–¹æ³•ã€‚

```typescript
export interface ScatterMapProps {
    data: any[] // array of objects
    filter?: mapboxgl.Expression // to filter points
    categoryItems?: string[] // In order to make different categories appear in different colors
    categoryName?: string // the key that represent categories in the properties
    getLongitude?: (d: object) => number // how to get logitude from each object in data array
    getLatitude?: (d: object) => number // how to get latitude from each object in data array
    propertiesHandler?: (d: object) => object // convert each object in the data array into properties that will be fed into the point layer in ScatterMap
    children?: React.ReactNode 
    tooltipContent?: React.ReactNode // for the tooltip content
    onMouseOn?: (hoverInfo: HoverInfo) => void // when mouse hover on the point
    onMouseOut?: () => void // when mouse hover out the point
}
```

æœ€å¾Œå†åˆ° index.tsx ä¸Šé¢ï¼ŒæŠŠ controller çš„é‚è¼¯å¯«å®Œï¼ŒåŸºæœ¬ä¸Šéƒ½åªéœ€è¦ç”¨åˆ° useState è·Ÿ eventHandler å°±å¯ä»¥å®Œæˆã€‚

#### å…¶ä»–çš„æ•´ç†èˆ‡æ‹†åˆ†

ä¸Šé¢çš„ ScatterMap åŸºæœ¬æ‹†å¥½äº†ï¼Œå‰©ä¸‹çš„æ˜¯ä¸€äº›é›¶æ•£çš„æ±è¥¿ï¼Œçœ‹ä¸€ä¸‹æª”æ¡ˆçµæ§‹é‚„å¤šäº†å“ªäº›
```
- @types
    - app.d.ts // æ”¾ä¸€äº›å…±ç”¨çš„ Type
- components // æ”¾ components
- utils // æ”¾ä¸€äº›å°å·¥å…·
    - helper // å¯¦åœ¨ä¸çŸ¥é“è¦æ”¾å“ªäº†ï¼Œå…ˆæ”¾é€™
    - palette // èª¿è‰²ç›¤ï¼Œæä¾› tailwind å…§å»ºçš„é¡è‰²çµ„è·Ÿä¸€äº›è‡ªå®šç¾©çš„æ–¹æ³•
```

helper è£¡é¢å°±ä¸€äº›å¾ˆå–®ç´”çš„å·¥å…·ï¼Œä¾‹å¦‚ rgba -> hex çš„è½‰æ›ï¼Œæ™‚é–“æ ¼å¼çš„é¡¯ç¤ºæ–¹æ³•èˆ‡è½‰æ›æ–¹æ³•ï¼Œä»¥åŠä¸Šé¢æåˆ°çš„ filterProducerã€‚

palette æœ¬èº«å°±åªæ˜¯æä¾›ä¸€äº›é¡è‰²çµ„åˆï¼Œä½†æ˜¯åè€ŒèŠ±äº†è¶…å¤šæ™‚é–“åœ¨é€™å€‹ä¸Šé¢ï¼ŒåŸæœ¬æƒ³è¦æä¾›é¡ä¼¼ Array çš„æ–¹å¼ï¼Œä½†æ±æè¥¿æï¼Œå°±æ˜¯æä¸å‡ºæˆ‘å€‘å¸Œæœ›è®“ä½¿ç”¨è€…ç”¨çš„æ–¹å¼ï¼Œæœ€å¾ŒæŠ˜è¡·æ›ä¸€ç¨®æ–¹å¼å¯¦ç¾ã€‚æœ€ä¸»è¦æƒ³è¦æä¾›å…©å€‹å‡½å¼ï¼Œç¬¬ä¸€å€‹é”æˆå¾ªç’°å–ç”¨åŒä¸€çµ„é¡è‰²çš„æ•ˆæœï¼Œç¬¬äºŒå€‹æ˜¯è·³è‘—å–ç”¨é¡è‰²çš„æ•ˆæœã€‚åŸæœ¬æ˜¯å¸Œæœ›æä¾›ä¸€å€‹å¢å¼·çš„ Array ï¼Œè®“ä½¿ç”¨è€…ä½¿ç”¨ï¼Œä½†å¾Œä¾†å¯¦åœ¨ä¸çŸ¥é“æ€éº¼ç”¨ JavaScript Functional Inheritance çš„å¯«æ³•ï¼Œä¾†è‡ªå®šç¾©ä¸€å€‹è‡ªå·±çš„ Array (ä¸æ”¹è®ŠåŸç”Ÿ Array )ï¼Œå¸Œæœ›æ”¹å¯« Array[idx] å–ç”¨è³‡æ–™çš„æ–¹å¼ï¼Œæ”¹æˆå¾ªç’°å–ç”¨ï¼Œä¸¦ä¸”å¦å¤–æä¾›ä¸€å€‹ jumpget çš„ Methodã€‚æ˜¯æœ‰çœ‹åˆ°å¦‚ä½•ç”¨ Class å¯¦ç¾ï¼Œä½†åŸºæ–¼é¢¨æ ¼ä¸€è‡´æ€§ï¼Œä¸å¤ªå¸Œæœ›ç”¨åˆ° Classã€‚æœ€å¾Œæ”¾æ£„ç”¨ Array çš„æ–¹å¼å›å‚³ï¼Œè€Œæ˜¯å›å‚³ç‰©ä»¶å…·æœ‰å…©å€‹æ“ä½œæ–¹æ³•ï¼Œç„¶å¾Œç”¨ Proxy å»æ””æˆª array çš„ getï¼Œå°‡è¼¸å…¥çš„ index æ”¹ç‚º index % lengthã€‚

é—œæ–¼é€™éƒ¨åˆ†çš„ä¸€äº›åƒè€ƒæ–‡ç« 
- [JavaScript Inheritance without ES6 classes](https://rajeshnaroth.medium.com/javascript-inheritance-without-es6-classes-6ff546c0d58b)
- [Getter/setter on javascript array?](https://stackoverflow.com/questions/2449182/getter-setter-on-javascript-array)

#### component ä¸€ç›´è¢«èª¿ç”¨?

ä¸»è¦å°±æ˜¯å¸¸å¸¸æœƒçœ‹åˆ°é‡è¤‡çš„ console.log è¢«èª¿ç”¨æ„Ÿåˆ°éå¸¸ä¸è§£ï¼Œå°¤å…¶æ˜¯ç•¶ setState ä¹‹å¾Œã€‚state æ”¹è®Šä¹‹å¾Œï¼ŒReact Component å°±æœƒè¢«èª¿ç”¨ï¼Œç„¶å¾Œè·‘å‡º console.logã€‚ä¸€ç›´ä»¥ç‚ºæ˜¯è‡ªå·±å¯«æ³•æœ‰å•é¡Œï¼Œä½†å¾é€™ç¯‡çœ‹èµ·ä¾†ï¼Œå¥½åƒæ˜¯ä¸€ç¨®æ­£å¸¸çš„æƒ…æ³ï¼Ÿ

[Why does React call my component more times than needed?](https://stackoverflow.com/questions/68666070/why-does-react-call-my-component-more-times-than-needed)

#### å…¶ä»–æ”¶ç©«
- [rgba2hex çš„æ–¹æ³•](https://stackoverflow.com/questions/49974145/how-to-convert-rgba-to-hex-color-code-using-javascript): åŸºæœ¬é‚è¼¯å°±æ˜¯å…ˆå°‡ 0 ~ 1 çš„å€¼æŠ•å½±æˆ 0 ~ 255ï¼Œç„¶å¾Œå†è½‰æˆ 16 é€²ä½ï¼Œæœ€å¾Œä¾ç…§ rgba çš„é †åºï¼Œæ‹¼æ¥èµ·ä¾†ã€‚å¤§æ¦‚é‚è¼¯æ˜¯é€™æ¨£ï¼Œä½†é‚„æœ‰ä¸€äº›æ“ä½œæ²’çœ‹å¾—å¾ˆæ˜ç™½ï¼Œç¸½ä¹‹å¯ä»¥ç”¨äº†ã€‚
- unixtimestamp è½‰æ›çš„æ™‚å€™è¦ * 1000 å†ç”¨
- getTimezoneOffset è¿”å›æ ¼æ—å¨æ²»æ™‚é–“å’Œæœ¬åœ°æ™‚é–“ä¹‹é–“çš„æ™‚å·®ï¼Œä»¥åˆ†é˜ç‚ºå–®ä½ã€‚


## Getting Started
This is a [Next.js](https://nextjs.org/) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

First, run the development server:

```bash
npm run dev
# or
yarn dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `pages/index.tsx`. The page auto-updates as you edit the file.

[API routes](https://nextjs.org/docs/api-routes/introduction) can be accessed on [http://localhost:3000/api/hello](http://localhost:3000/api/hello). This endpoint can be edited in `pages/api/hello.ts`.

The `pages/api` directory is mapped to `/api/*`. Files in this directory are treated as [API routes](https://nextjs.org/docs/api-routes/introduction) instead of React pages.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js/) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/deployment) for more details.
